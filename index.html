<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <script defer type="module" src="/main.js"></script>
    <link rel="stylesheet" href="/styles/base.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="bg-primary h-screen  flex flex-col font-inter" x-data>
    <!-- Login/Register Form -->
    <template x-if="!$store.auth.isAuthenticated">
      <div class="w-screen h-screen absolute inset-0 md:flex bg-primary">
      <!-- Mobile Background -->
      <!-- <div class="fixed inset-0 bg-primary md:hidden -z-10"></div> -->

      <!-- Left side - Form -->
      <div
        class="w-full md:w-2/5 p-4 md:p-8 flex items-center justify-center md:bg-white"
      >
        <div
          x-data="loginForm"
          class="w-full max-w-md bg-white md:bg-transparent rounded-xl p-6 md:p-0"
        >
          <template x-if="!isRegistering">
            <!-- Login Form -->
            <div>
              <h2 class="text-2xl font-bold mb-3">Login</h2>
              <p class="login-instruction mb-6">
                Entre com seu email e senha cadastrados ou crie um cadastro.
              </p>

              <form @submit.prevent="handleSubmit">
                <div class="space-y-4">
                  <div>
                    <label
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Email
                    </label>
                    <input
                      type="email"
                      x-model="formData.username"
                      class="input"
                      required
                    />
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Senha
                    </label>
                    <input
                      type="password"
                      x-model="formData.password"
                      class="input"
                      required
                    />
                  </div>

                  <div
                    x-show="formData.error"
                    x-text="formData.error"
                    class="text-red-600 text-sm"
                  ></div>

                  <button type="submit" class="btn btn-primary w-full">
                    Entrar
                  </button>

                  <div class="text-center">
                    <span class="text-gray-500 login-instruction"
                      >Ainda não possui Cadastro?
                    </span>
                    <button
                      @click="toggleForm"
                      type="button"
                      class="text-primary hover:underline login-instruction"
                    >
                      Cadastrar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </template>

          <template x-if="isRegistering">
            <!-- Register Form -->
            <div>
              <h2 class="text-2xl font-bold mb-3">Cadastro</h2>
              <p class="login-instruction mb-6">
                Preencha os dados abaixo para criar sua conta.
              </p>

              <form @submit.prevent="handleSubmit">
                <div class="space-y-4">
                  <div class="grid grid-cols-2 gap-4">
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-1"
                      >
                        Nome
                      </label>
                      <input
                        type="text"
                        x-model="formData.firstName"
                        class="input"
                        required
                      />
                    </div>
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-1"
                      >
                        Sobrenome
                      </label>
                      <input
                        type="text"
                        x-model="formData.lastName"
                        class="input"
                        required
                      />
                    </div>
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Email
                    </label>
                    <input
                      type="email"
                      x-model="formData.username"
                      class="input"
                      required
                    />
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Senha
                    </label>
                    <input
                      type="password"
                      x-model="formData.password"
                      class="input"
                      required
                    />
                  </div>

                  <div>
                    <label
                      class="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Confirmar Senha
                    </label>
                    <input
                      type="password"
                      x-model="formData.confirmPassword"
                      class="input"
                      required
                    />
                  </div>

                  <div
                    x-show="formData.error"
                    x-text="formData.error"
                    class="text-red-600 text-sm"
                  ></div>

                  <button type="submit" class="btn btn-primary w-full">
                    Cadastrar
                  </button>

                  <div class="text-center">
                    <span class="text-gray-500 login-instruction"
                      >Já possui conta?
                    </span>
                    <button
                      @click="toggleForm"
                      type="button"
                      class="text-primary hover:underline login-instruction"
                    >
                      Entrar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </template>
        </div>
      </div>

      <!-- Right side - Background Image (hidden on mobile) -->
      <div
        class="hidden md:block w-3/5 bg-no-repeat bg-cover bg-bottom bg-primary bg-login-img"
      ></div>
    </div>
  </template>

    <!-- Navbar -->
    <template x-if="$store.auth.isAuthenticated">
      <nav x-data="navbar" class="relative z-50">
        <div class="container mx-auto px-4 py-3">
          <div class="flex justify-between items-center">
            <div class="flex items-center space-x-4 text-white">
              <img src="/public/logo-white.png" alt="Logo" class="h-8 w-auto" />
              <div>
                <span
                  class="text-lg font-semibold"
                  x-text="'Olá, ' + $store.auth.user?.username"
                ></span>
                <span
                  class="text-xs ml-2 align-text-top"
                  x-text="$store.auth.user?.type || 'Lojista'"
                ></span>
              </div>
            </div>

            <div class="flex items-center space-x-4">
              <!-- Notifications Dropdown -->
              <div class="relative" x-data="{ open: false }">
                <button
                  @click="open = !open"
                  class="p-2 hover:bg-primary-dark rounded-full"
                >
                  
                  <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.574463 17V15H2.69274V8C2.69274 6.61667 3.13404 5.38767 4.01666 4.313C4.89927 3.23834 6.04667 2.534 7.45886 2.2V1.5C7.45886 1.08334 7.61349 0.729336 7.92276 0.438002C8.23203 0.146669 8.60696 0.000668939 9.04756 2.27273e-06C9.48816 -0.000664394 9.86345 0.145336 10.1734 0.438002C10.4834 0.730669 10.6377 1.08467 10.6363 1.5V2.2C12.0485 2.53334 13.1958 3.23767 14.0785 4.313C14.9611 5.38834 15.4024 6.61734 15.4024 8V15H17.5207V17H0.574463ZM9.04756 20C8.46504 20 7.96654 19.8043 7.55206 19.413C7.13758 19.0217 6.92999 18.5507 6.92929 18H11.1658C11.1658 18.55 10.9586 19.021 10.5441 19.413C10.1296 19.805 9.63079 20.0007 9.04756 20ZM4.81101 15H13.2841V8C13.2841 6.9 12.8693 5.95834 12.0396 5.175C11.21 4.39167 10.2126 4 9.04756 4C7.88251 4 6.88516 4.39167 6.0555 5.175C5.22584 5.95834 4.81101 6.9 4.81101 8V15Z" fill="white"/>
                  </svg>
                    
                </button>
                <div
                  x-show="open"
                  @click.away="open = false"
                  class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg py-2 z-50"
                >
                  <div class="px-4 py-2 border-b border-gray-200">
                    <h3 class="font-semibold">Notifications</h3>
                  </div>
                  <div class="max-h-64 overflow-y-auto">
                    <template
                      x-for="notification in notifications"
                      :key="notification.id"
                    >
                      <div class="px-4 py-2 hover:bg-gray-50">
                        <p x-text="notification.message" class="text-sm"></p>
                        <span
                          x-text="notification.time"
                          class="text-xs text-gray-500"
                        ></span>
                      </div>
                    </template>
                  </div>
                </div>
              </div>

              <!-- Profile Dropdown -->
              <div class="relative" x-data="{ open: false }">
                <button
                  @click="open = !open"
                  class="p-2 bg-primary-light hover:bg-primary-dark rounded-full"
                >
                <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14.9604 13.052C14.5814 12.1543 14.0315 11.3389 13.3412 10.6513C12.653 9.96164 11.8377 9.41179 10.9405 9.03209C10.9325 9.02807 10.9244 9.02606 10.9164 9.02204C12.1679 8.11803 12.9816 6.64548 12.9816 4.9841C12.9816 2.23186 10.7517 0.00195312 7.99942 0.00195312C5.24719 0.00195312 3.01728 2.23186 3.01728 4.9841C3.01728 6.64548 3.8309 8.11803 5.08246 9.02405C5.07442 9.02807 5.06639 9.03008 5.05835 9.0341C4.15835 9.41378 3.35076 9.95821 2.65768 10.6533C1.96804 11.3415 1.41818 12.1567 1.03848 13.054C0.665471 13.9324 0.464297 14.8741 0.445851 15.8283C0.445315 15.8497 0.449076 15.8711 0.456912 15.891C0.464748 15.911 0.476501 15.9292 0.491479 15.9445C0.506456 15.9599 0.524355 15.9721 0.54412 15.9804C0.563885 15.9887 0.585118 15.993 0.606565 15.993H1.81192C1.90032 15.993 1.97063 15.9227 1.97264 15.8363C2.01282 14.2854 2.63558 12.833 3.73648 11.7321C4.87554 10.593 6.38826 9.96624 7.99942 9.96624C9.61058 9.96624 11.1233 10.593 12.2624 11.7321C13.3633 12.833 13.986 14.2854 14.0262 15.8363C14.0282 15.9247 14.0985 15.993 14.1869 15.993H15.3923C15.4137 15.993 15.435 15.9887 15.4547 15.9804C15.4745 15.9721 15.4924 15.9599 15.5074 15.9445C15.5223 15.9292 15.5341 15.911 15.5419 15.891C15.5498 15.8711 15.5535 15.8497 15.553 15.8283C15.5329 14.868 15.334 13.9339 14.9604 13.052ZM7.99942 8.43946C7.07732 8.43946 6.20947 8.07986 5.55657 7.42695C4.90366 6.77405 4.54407 5.9062 4.54407 4.9841C4.54407 4.062 4.90366 3.19414 5.55657 2.54124C6.20947 1.88834 7.07732 1.52874 7.99942 1.52874C8.92152 1.52874 9.78938 1.88834 10.4423 2.54124C11.0952 3.19414 11.4548 4.062 11.4548 4.9841C11.4548 5.9062 11.0952 6.77405 10.4423 7.42695C9.78938 8.07986 8.92152 8.43946 7.99942 8.43946Z" fill="white"/>
                  </svg>
                  
                </button>
                <div
                  x-show="open"
                  @click.away="open = false"
                  class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50"
                >
                  <a href="#" class="block px-4 py-2 hover:bg-gray-100">
                    <i class="fas fa-key mr-2"></i> Manage Password
                  </a>
                  <a href="#" class="block px-4 py-2 hover:bg-gray-100">
                    <i class="fas fa-user-cog mr-2"></i> Manage Profile
                  </a>
                  <hr class="my-2" />
                  <button
                    @click="logout"
                    class="block w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600"
                  >
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </template>

    <!-- Main Content -->
    <main class="w-100 flex-grow bg-white rounded-tl-3xl rounded-tr-2xl px-16">
      <div class="container mx-auto">
        

        <!-- Dashboard -->
        <template x-if="$store.auth.isAuthenticated" x-cloak>
          <div x-data="dashboard">
            <!-- Tabs -->
            <div class="border-b border-gray-200 mb-6">
              <nav class="flex space-x-8">
                <template x-for="tab in tabs" :key="tab.id">
                  <button
                    @click="activeTab = tab.id"
                    :class="{'border-b-2 border-blue-500 text-primary': activeTab === tab.id}"
                    class="py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 flex"
                  >
                  <span x-html="tab.icon"></span>
                  <span class="pl-3" x-text="tab.name"></span>
                </button>
                </template>
              </nav>
            </div>

            <!-- Tab Content -->
            <div class="relative z-0">
              <!-- Dashboard -->
              <div
                data-tab="dashboard"
                :style="activeTab === 'dashboard' ? '' : 'display: none'"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <template x-for="card in dashboardCards" :key="card.id">
                  <div class="card" :class="card.big ? 'col-span-3' : ''">
                    <div class="header flex justify-between">
                      <h3
                      class="text-lg font-semibold text-neutral-dark"
                      x-text="card.title"
                    ></h3>
                    <span class="text-primary" x-show="card.headerLink" x-text="card.headerLink">
                      <!-- TODO: Modal com lista completa -->
                    </span>
                    </div>
                    <div class="body" :class="card.big ? 'py-4' : 'py-6 h-48'">
                      <template x-if="card.type == 'bargraph'">
                        <canvas x-data="{ id: $id('canvas') }" :id="id" x-init="draw_bargraph(id, card.data, card.labels)"></canvas>
                      </template>
                      <template x-if="card.type == 'number'">
                        <div class="h-full flex flex-col justify-between">
                          <div class="py-3.5">
                            <h1 x-text="card.value" class="text-primary-light font-bold text-4xl"></h1>
                        <p class="text-neutral" x-text="card.subtitle"></p>
                          </div>
                        
                        <div class="border-t pt-3 flex justify-between text-neutral">
                          <span>Período analisado</span>
                          <span class="flex items-center gap-x-2.5">
                            <span x-text="card.inicio"></span>
                            <svg width="12" height="6" viewBox="0 0 12 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M11.6422 4.31563L9.07969 1.06563C9.03296 1.00629 8.97339 0.958321 8.90547 0.925306C8.83755 0.892291 8.76302 0.875092 8.6875 0.875H7.675C7.57031 0.875 7.5125 0.995312 7.57656 1.07812L9.83125 3.9375H0.375C0.30625 3.9375 0.25 3.99375 0.25 4.0625V5C0.25 5.06875 0.30625 5.125 0.375 5.125H11.2484C11.6672 5.125 11.9 4.64375 11.6422 4.31563Z" fill="currentColor"/>
                            </svg>                              
                            <span x-text="card.fim"></span>
                          </span>
                        </div>
                      </div>
                      </template>

                      <template x-if="card.type == 'table'">
                        <template x-for="item in card.items" :key="item.position">
                          <div class="flex gap-3.5 items-center py-2">
                            <span class="text-neutral w-4" x-text="item.position"></span>
                            <span 
                            class="w-10 h-10 rounded-full border place-content-center overflow-hidden" 
                            :class="item.position == 1 ? 'border-[#F08A00]' : ''"
                            x-html="item.img"
                            ></span>
                            <span class="grow text-neutral-dark" x-text="item.name"></span>
                            <span class="p-2 rounded-lg" :class="item.position == 1 ? 'bg-[#FFF7CD] text-[#F08A00]' : ''">
                              <span x-text="item.points"></span> Pontos
                            </span>
                          </div>
                        </template>
                      </template>

                    </div>
                  </div>
                </template>
              </div>

              <!-- Pedidos -->
              <div
                data-tab="pedidos"
                :style="activeTab === 'pedidos' ? '' : 'display: none'"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <div class="card p-6 col-span-full">
                  <h3 class="text-lg font-semibold mb-2">Pedidos Page</h3>
                  <p class="text-gray-600">Sample content for Pedidos tab</p>
                </div>
              </div>

              <!-- Arquitetos -->
              <div
                data-tab="arquitetos"
                :style="activeTab === 'arquitetos' ? '' : 'display: none'"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <div class="card p-6 col-span-full">
                  <h3 class="text-lg font-semibold mb-2">Arquitetos Page</h3>
                  <p class="text-gray-600">Sample content for Arquitetos tab</p>
                </div>
              </div>

              <!-- Experiencias -->
              <div
                data-tab="experiencias"
                :style="activeTab === 'experiencias' ? '' : 'display: none'"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <div class="card p-6 col-span-full">
                  <h3 class="text-lg font-semibold mb-2">Experiências Page</h3>
                  <p class="text-gray-600">Sample content for Experiências tab</p>
                </div>
              </div>

              <!-- Campanhas Bonus -->
              <div
                data-tab="campanhas"
                :style="activeTab === 'campanhas' ? '' : 'display: none'"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <div class="card p-6 col-span-full">
                  <h3 class="text-lg font-semibold mb-2">Campanhas Bônus Page</h3>
                  <p class="text-gray-600">
                    Sample content for Campanhas Bônus tab
                  </p>
                </div>
              </div>
            </div>
          </div>
        </template>
      </div>
    </main>
  </body>
</html>
